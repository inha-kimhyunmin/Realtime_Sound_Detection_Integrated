# 실시간 소리 탐지 통합 시스템

실시간으로 마이크 입력을 받아 환경 소리 위험 탐지와 기계 이상 진단을 수행하는 AI 기반 오디오 분석 시스템

## 시스템 개요

이 시스템은 다음 두 가지 AI 모델을 통합하여 공장 환경에서 실시간 안전 모니터링을 제공합니다:

1. **환경 소리 위험 탐지** (YAMNet + LSTM)
   - 화재, 가스누출, 비명 등 위험 소리 실시간 감지
   - 5초 단위 세그먼트로 분석

2. **기계 이상 진단** (CNN + 스펙트로그램 분석)
   - 베어링, 팬, 기어박스, 펌프, 슬라이더 이상 탐지
   - 10초 오디오로 이상 확률 예측

## 주요 기능

### 🎤 실시간 다채널 오디오 처리
- 멀티스레드 기반 실시간 오디오 스트리밍
- 다채널 마이크 입력 지원
- 5초/10초 세그먼트 자동 생성

### 🧠 AI 기반 위험 탐지
- **YAMNet**: Google 사전훈련 모델로 음향 특징 추출
- **LSTM**: 시간적 패턴 분석으로 위험 상황 판단
- **클래스**: 무음, 정상(공장), 화재, 가스누출, 비명

### 🔧 기계 이상 진단
- **멜 스펙트로그램**: 오디오를 2D 이미지로 변환
- **CNN 모델**: 부품별 특화된 ONNX 모델
- **특징 추출**: 부품별 스펙트럼 특성 분석

### ⚙️ 마이크 자동 캘리브레이션
- 공장 소리 기준 게인 자동 조정
- 무음/배경 소음 레벨 측정
- JSON 파일로 설정 저장

## 시스템 구조

```
실시간 오디오 입력 → 5초 세그먼트 → 환경 소리 AI 판단
                                    ↓
                              공장 소리 2회 연속
                                    ↓
                              10초 결합 → 기계 이상 AI 진단
```

## 설치 및 실행

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. 마이크 캘리브레이션 (최초 1회)
```bash
python Calibration.py
```

### 3. 실시간 모니터링 시작
```bash
python main.py
```

## 파일 구조

```
├── main.py                     # 메인 실행 파일
├── Calibration.py             # 마이크 캘리브레이션
├── config.py                  # 시스템 설정
├── model.py                   # YAMNet+LSTM 모델 함수
├── machine_anomaly_detection.py  # 기계 이상 진단 모델
├── audio_preprocessing.py     # 오디오 전처리
├── Realtime_recording.py      # 실시간 오디오 녹음
├── requirements.txt           # Python 패키지 목록
└── model/                     # AI 모델 파일
    ├── Danger_detect/         # 환경 위험 탐지 모델
    └── Machine_anomaly_detect/ # 기계 이상 진단 모델
```

## 설정

### config.py 주요 설정
- `SAMPLE_RATE`: 샘플링 레이트 (16000Hz)
- `MIC_NUM`: 마이크 채널 수
- `SEGMENT_DURATION`: 분석 세그먼트 길이 (5초)
- `FACTORY_THRESHOLD`: 공장 소리 판단 임계값
- `DANGER_THRESHOLD`: 위험 소리 판단 임계값

### 지원 기계 부품
- 베어링 (Bearing)
- 팬 (Fan)  
- 기어박스 (Gearbox)
- 펌프 (Pump)
- 슬라이더 (Slider)

## 출력 결과

### 환경 소리 탐지
```
환경 소리 AI모델 판단 결과
무음 : 0.05
정상(공장) : 0.85
화재 : 0.03
가스누출 : 0.04
비명 : 0.03
AI 예측 : 정상(공장), 확률 : 0.85
```

### 기계 이상 진단
```
부품명 : Factory-1_BEARING, 정상 여부 : True, 확률 : 0.943, 시간 : 2025-08-19 15:30:25
```

## 특징

- ⚡ **실시간 처리**: 병렬 스레드로 지연 없는 분석
- 🎯 **높은 정확도**: 사전훈련된 YAMNet + 맞춤형 LSTM
- 🔄 **연속 모니터링**: 24시간 무중단 감시 가능
- 📊 **다차원 분석**: 시간, 주파수, 스펙트럼 특성 종합 판단
- ⚙️ **자동 캘리브레이션**: 환경에 맞는 자동 설정

## 개발 환경

- Python 3.8+
- TensorFlow 2.x
- PyTorch (기계 진단용)
- ONNX Runtime
- sounddevice

## 라이선스

이 프로젝트는 연구 및 교육 목적으로 개발되었습니다.
